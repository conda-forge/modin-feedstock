# Updating the Conda Feedstock

Once the new release is finalized, a bot will open a PR on this repository in order to update the conda feedstock. CI will probably fail on this PR, because there are patches that we need to manually update. These patches remove dependencies from `env_hdk.yml` and `setup.py` in the Modin repository. You'll need to update the dependencies in `recipe/meta.yaml` based off of the dependencies we remove in the patches.

You can either push directly to the bot's PR in order to make these changes, or you can make these changes to your fork of the modin-feedstock repo. If you are using your fork of the modin-feedstock repo, an ideal way to start is to add the [bot's fork](https://github.com/regro-cf-autotick-bot/modin-feedstock.git) as a remote, and work off of its branch for the release - opening your own PR when you're done.

## Creating Commits for Patches

Inside either your fork of Modin, or the release copy you cloned in order to build the pip package, checkout either:

* The release branch (if working on releasing a patch version)
* Modin's master branch (if working on a major or a minor version)

Once you've checked out these files, you need to make 2 commits (can be made in any order).

### `env_hdk.yml` commit

You'll need to comment out some of the dependencies from this file<sup>*</sup>. In order to ensure that you have removed all of the necessary dependencies,
check the patch introduced by the PR for the previous release version. After making these changes, commit the file with the commit message "Remove dependencies from env_hdk.yml."

<sup>*</sup> At the time of writing this document (10/02/2023), the dependencies that need to be commented out are `pandas`, `numpy`, `pyhdk` and `s3fs`. This may change; however, so be sure
to check the patch file for the previous release version in order to see what dependencies need to be commented out.

### `setup.py` commit

You'll need to replace the following list entries with empty lists in `setup.py`:

* `dask_deps`
* `ray_deps`
* `mpi_deps`
* `spreadsheet_deps`
* `install_requires`

Once you've set these entries to empty lists, commit the file with the commit message "Remove dependencies from setup.py."

## Building Patches

Once you've committed the above two commits, run `git format-patch -2 HEAD`. This will output two filenames - each corresponding to one of the commits above. Replace each patch in the feedstock repo with the corresponding patch generated by this command.

## Updating `recipe/meta.yaml`

Once you've added the patches to the repo, you'll need to update the recipes in `recipe/meta.yaml` with the dependencies you've removed. Go through each recipe, and make sure that the specified version matches the version pinned in either `setup.py` or `env_hdk.yaml`. Once you've updated these recipes, your PR should be good to go!
